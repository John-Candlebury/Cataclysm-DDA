[
  {
    "id": "wells_machine_control",
    "type": "SPELL",
    "name": "Warlord control",
    "description": "Labyrinth warlord control themselves using this spell.",
    "valid_targets": [ "self" ],
    "flags": [ "SILENT", "NO_EXPLOSION_SFX" ],
    "shape": "blast",
    "min_range": 1,
    "max_range": 1,
    "message": "",
    "effect": "effect_on_condition",
    "effect_str": "EOC_wells_machine_control"
  },
  {
    "type": "SPELL",
    "id": "wells_machine_hurt_self",
    "name": { "str": "Wretch Hurt Self" },
    "description": "Hurts yourself.",
    "flags": [ "RANDOM_DAMAGE", "NO_PROJECTILE", "NO_EXPLOSION_SFX" ],
    "min_damage": 1200,
    "max_damage": 1500,
    "damage_type": "pure",
    "valid_targets": [ "hostile", "ally", "self", "ground" ],
    "shape": "blast",
    "effect": "attack"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_wells_machine_control",
    "effect": [
      {
        "run_eocs": [
          {
            "id": "eoc_start_update_wells_machine_walkers",
            "condition": { "math": [ "updating_wells_machines", "!=", "1" ] },
            "effect": [ { "run_eocs": "eoc_update_wells_machine_walkers" } ]
          },
          {
            "id": "wells_machine_setup",
            "condition": { "math": [ "u_setup", "!=", "1" ] },
            "effect": [
              {
                "run_eocs": [
                  {
                    "id": "avatar_sees_wells_machine_setup",
                    "condition": "player_see_u",
                    "effect": [ { "message": "You see the alien construct unfold itself in a single graceful motion." } ]
                  }
                ]
              },
              { "math": [ "_warlord_uid", "=", "rand(1200)" ] },
              { "math": [ "u_warlord_uid", "=", "_warlord_uid" ] },
              { "math": [ "u_setup", "=", "1" ] },
              { "u_spawn_monster": "mon_wells_machine_leg", "real_count": 3, "min_radius": 1, "max_radius": 1 },
              {
                "u_run_monster_eocs": [ { "id": "wells_machine_leg_assign", "effect": [ { "math": [ "u_warlord_id", "=", "_warlord_uid" ] } ] } ],
                "monster_range": 2,
                "mtype_ids": [ "mon_wells_machine_leg" ]
              },
              { "math": [ "u_timer_wells_machine_heat_ray", "=", "time('now')" ] },
              { "math": [ "u_timer_wells_machine_smoke", "=", "time('now')" ] }
            ]
          },
          { "id": "wells_machine_combat_strategy", "effect": [  ] }
        ]
      }
    ]
  },
  {
    "id": "eoc_update_wells_machine_walkers",
    "type": "effect_on_condition",
    "global": true,
    "condition": { "math": [ "u_monsters_nearby('mon_wells_machine', 'radius': 60)", ">=", "1" ] },
    "effect": [
      { "math": [ "updating_wells_machines", "=", "1" ] },
      { "queue_eocs": "eoc_update_wells_machine_walkers", "time_in_future": 1 },
      {
        "u_run_monster_eocs": [ "eoc_wells_machine_walker" ],
        "monster_range": 65,
        "mtype_ids": [ "mon_wells_machine" ]
      }
    ],
    "false_effect": [ { "math": [ "updating_wells_machines", "=", "0" ] } ]
  },
  {
    "id": "eoc_wells_machine_walker",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "_warlord_uid", "=", "u_warlord_uid" ] },
      { "u_location_variable": { "context_val": "warlord_pos_1" }, "x_adjust": 1, "y_adjust": 1 },
      { "u_location_variable": { "context_val": "warlord_pos_2" }, "x_adjust": -1, "y_adjust": 1 },
      { "u_location_variable": { "context_val": "warlord_pos_3" }, "y_adjust": -1 },
      {
        "u_run_monster_eocs": [
          {
            "id": "wells_machine_leg_tp",
            "condition": { "math": [ "u_warlord_id", "==", "_warlord_uid" ] },
            "effect": [
              { "u_teleport": { "context_val": "warlord_pos_1" } },
              { "u_teleport": { "context_val": "warlord_pos_2" } },
              { "u_teleport": { "context_val": "warlord_pos_3" } },
              { "u_teleport": { "context_val": "warlord_pos_4" } }
            ]
          }
        ],
        "monster_range": 20,
        "mtype_ids": [ "mon_wells_machine_leg" ]
      }
    ]
  },
  {
    "id": "EOC_wells_machine_hurt",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "_warlord_uid", "=", "u_warlord_id" ] },
      {
        "u_run_monster_eocs": [
          {
            "id": "wells_machine_leg_hurt",
            "condition": { "math": [ "u_warlord_uid", "==", "_warlord_uid" ] },
            "effect": [ { "u_cast_spell": { "id": "wells_machine_hurt_self" } } ]
          }
        ],
        "monster_range": 60
      }
    ]
  },
  {
    "id": "EOC_wells_machine_dies",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "_warlord_uid", "=", "u_warlord_uid" ] },
      {
        "u_run_monster_eocs": [
          {
            "id": "wells_machine_leg_dies",
            "condition": { "math": [ "u_warlord_id", "==", "_warlord_uid" ] },
            "effect": [ { "u_cast_spell": { "id": "wells_machine_hurt_self" } } ]
          }
        ],
        "monster_range": 20,
        "mtype_ids": [ "mon_wells_machine_leg" ]
      }
    ]
  },
  {
    "id": "eoc_wells_machine_deltas",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "time_since(u_timer_wells_machine_deltas)", ">", "time(' 1 m')" ] },
        { "math": [ "u_monsters_nearby('mon_yrax_delta', 'radius': 40)", "<", "3" ] }
      ]
    },
    "effect": [  ]
  },
  {
    "id": "eoc_wells_machine_smoke",
    "type": "effect_on_condition",
    "condition": { "and": [ { "math": [ "time_since(u_timer_wells_machine_smoke)", ">", "time(' 40 s')" ] } ] },
    "effect": [  ]
  }
]
